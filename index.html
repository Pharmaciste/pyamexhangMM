<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mammon Timer â€” Executive Hangar</title>
<meta name="color-scheme" content="dark">
<style>
  :root{
    --bg:#0a0a0a; --panel:#111111ee; --panel-border:rgba(255,255,255,.08);
    --text:#fefce8; --ok:#22c55e; --danger:#ef4444;
    --accent:#facc15; --accent2:#fde047;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font:16px/1.55 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wm{position:fixed;inset:0;background:url('/assets/mammon.png') center 40%/min(90vmin,1200px) no-repeat;
      opacity:.15;pointer-events:none;filter:drop-shadow(0 0 22px rgba(0,0,0,.65))}
  .wrap{max-width:960px;margin:0 auto;padding:20px;position:relative;z-index:1}

  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  .brand{display:flex;align-items:center;gap:8px}
  .brand h1{font-size:20px;font-weight:900;margin:0;color:var(--accent)}
  .badge{font-size:11px;font-weight:900;padding:4px 8px;border-radius:999px;
         background:#000;color:var(--accent);border:1px solid var(--accent)}
  .patch{font-size:13px;color:var(--ok)}

  .discord-bar{background:#1a1a1a;border:1px solid rgba(255,255,255,.1);border-radius:12px;
               padding:10px 14px;margin-bottom:16px;text-align:center}
  .discord-bar a{color:var(--accent2);font-weight:700;text-decoration:none}

  h2{font-size:22px;font-weight:900;margin:0 0 10px;color:var(--accent)}
  .big{font:64px/1.2 monospace;margin:12px 0}
  .big.open{color:var(--ok)}.big.closed{color:var(--danger)}

  .until{font:14px monospace;opacity:.95;margin:6px 0}
  .clock{font:56px/1 monospace;margin:10px 0;color:var(--accent)}
  .status{font-weight:900}
  .status.open{color:var(--ok)}.status.closed{color:var(--danger)}

  .row{display:flex;gap:10px;justify-content:center;margin:12px 0}
  .led{width:22px;height:22px;border-radius:7px;background:#222;border:1px solid rgba(0,0,0,.6)}
  .led.g{background:var(--ok);box-shadow:0 0 14px rgba(34,197,94,.7)}
  .led.r{background:var(--danger);box-shadow:0 0 12px rgba(239,68,68,.6)}

  .sched{margin-top:24px}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px 10px;border-top:1px solid rgba(255,255,255,.1)}
  th{color:var(--accent)}
  .tag{padding:2px 8px;border-radius:999px;font-size:12px}
  .tag.on{background:rgba(34,197,94,.12);color:var(--ok);border:1px solid rgba(34,197,94,.45)}
  .tag.off{background:rgba(239,68,68,.15);color:var(--danger);border:1px solid rgba(239,68,68,.45)}
</style>
</head>
<body>
<div class="wm"></div>
<div class="wrap">

  <!-- Header -->
  <header>
    <div class="brand">
      <h1>MAMMON TIMER</h1>
      <span class="badge">LIVE</span>
    </div>
    <div class="patch">Updated for Star Citizen Patch 4.3.0-LIVE (Hotfix 10188864)</div>
  </header>

  <!-- Discord bar -->
  <div class="discord-bar">
    ðŸš€ Want to join <b>MAMMON</b>? <a href="https://discord.gg/aUBDScHG" target="_blank">Join our Discord here!</a>
  </div>

  <!-- Timer -->
  <section class="panel">
    <h2>Executive Hangar Timer</h2>
    <div id="statusBig" class="big closed">OFFLINE</div>
    <div class="until">Time until next change: <span id="until">--:--</span></div>
    <div class="row" id="leds">
      <div class="led r"></div><div class="led r"></div><div class="led r"></div><div class="led r"></div><div class="led r"></div>
    </div>
    <div class="clock" id="clock">--:--:--</div>
    <div class="status closed" id="status">Hangar Closed</div>
    <div class="until" id="subtitle">Next transition in --:--</div>
    <div class="until" id="nextTimes">Next Close: â€” â€¢ Next Open: â€”</div>
    <div class="sched"><h3>Schedule (24h)</h3><div id="schedule"></div></div>
  </section>

</div>

<script>
const OPEN_SEC=65*60,CLOSED_SEC=2*3600+1,CYCLE_SEC=OPEN_SEC+CLOSED_SEC,CYCLE_MS=CYCLE_SEC*1000,DOTS=5;
const ANCHOR=new Date();ANCHOR.setHours(20,14,6,0);const anchor_ms=ANCHOR.getTime();
const elClock=document.getElementById('clock'),elUntil=document.getElementById('until'),
elStatus=document.getElementById('status'),elStatusBig=document.getElementById('statusBig'),
elSub=document.getElementById('subtitle'),elNext=document.getElementById('nextTimes'),
leds=document.getElementById('leds').children,scheduleDiv=document.getElementById('schedule');
const pad=n=>String(n).padStart(2,'0'),
fmtHMS=s=>`${pad((s/3600)|0)}:${pad((s%3600)/60|0)}:${pad(s%60)}`,
fmtMMSS=s=>`${Math.floor(s/60)}:${pad(s%60)}`,
pretty=ms=>new Date(ms).toLocaleString('en-GB',{dateStyle:'short',timeStyle:'short'});
function greensClosed(r){const seg=CLOSED_SEC/DOTS;return Math.max(0,Math.min(DOTS,DOTS-Math.ceil(r/seg))); }
function greensOpen(r){if(r<=300)return 0;const eff=Math.min(3600,r-300);return Math.min(DOTS,Math.ceil(eff/720)); }
function nextAfter(start,step,now){return now<start?start:start+(Math.floor((now-start)/step)+1)*step;}
let lastMin=-1;
function render(force=false){
  const now=Date.now(),elapsed=((now-anchor_ms)/1000%CYCLE_SEC+CYCLE_SEC)%CYCLE_SEC,isOpen=elapsed<OPEN_SEC;
  const phaseSec=isOpen?OPEN_SEC:CLOSED_SEC,phaseElapsed=isOpen?elapsed:(elapsed-OPEN_SEC),remain=phaseSec-phaseElapsed;

  // Timers
  elUntil.textContent=fmtMMSS(remain);     // mm:ss
  elClock.textContent=fmtHMS(remain);      // hh:mm:ss
  elSub.textContent='Next transition ('+(isOpen?'close':'open')+') in '+fmtMMSS(remain);

  // Status
  elStatus.textContent='Hangar '+(isOpen?'Open':'Closed');
  elStatus.className='status '+(isOpen?'open':'closed');
  elStatusBig.textContent=isOpen?'ONLINE':'OFFLINE';
  elStatusBig.className='big '+(isOpen?'open':'closed');

  // LEDs
  const g=isOpen?greensOpen(remain):greensClosed(remain);
  for(let i=0;i<DOTS;i++)leds[i].className='led '+(i<g?'g':'r');

  // Next events
  const nextOpen=nextAfter(anchor_ms,CYCLE_MS,now),nextClose=nextAfter(anchor_ms+OPEN_SEC*1000,CYCLE_MS,now);
  elNext.textContent=`Next Close: ${pretty(nextClose)} â€¢ Next Open: ${pretty(nextOpen)}`;

  // Update schedule once per minute
  const m=new Date(now).getMinutes();
  if(force||m!==lastMin){lastMin=m;updateSchedule(now);}
}
function updateSchedule(nowMs){
  const rows=[],horizon=nowMs+24*3600*1000;let n=Math.floor((nowMs-anchor_ms)/CYCLE_MS),open=anchor_ms+n*CYCLE_MS;
  if(open>nowMs){n--;open-=CYCLE_MS;}while(open<horizon){
    const cyc=49+Math.round((open-anchor_ms)/CYCLE_MS),close=open+OPEN_SEC*1000;
    if(open>=nowMs)rows.push({cyc,type:'on',at:open});
    if(close>=nowMs)rows.push({cyc,type:'off',at:close});
    open+=CYCLE_MS;
  }
  rows.sort((a,b)=>a.at-b.at);
  let html='<table><thead><tr><th>Cycle</th><th>Status</th><th>Local Time</th></tr></thead><tbody>';
  for(const r of rows){
    html+=`<tr><td>${r.cyc}</td><td><span class="tag ${r.type==='on'?'on':'off'}">${r.type==='on'?'Online':'Offline'}</span></td><td>${pretty(r.at)}</td></tr>`;
  }
  html+='</tbody></table>';scheduleDiv.innerHTML=html;
}
render(true);setInterval(render,1000);
</script>
</body>
</html>
