<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MAMMON TIMER</title>
<meta name="color-scheme" content="dark">
<style>
  :root{
    --bg:#0a0d14;
    --panel:#0b0f1aee;
    --panel-border:rgba(255,255,255,.08);
    --text:#ffffff;
    --ok:#22c55e;
    --danger:#ef4444;
    --accent:#fbbf24; --accent-2:#fde047;
    --shadow:rgba(0,0,0,.45);
  }
  *{box-sizing:border-box} html,body{margin:0;padding:0}
  body{
    font:16px/1.55 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text);
    background:
      radial-gradient(80vw 60vh at 70% -20%, rgba(253,224,71,.06), transparent 60%),
      radial-gradient(70vw 50vh at -10% 0%, rgba(251,191,36,.06), transparent 60%),
      var(--bg) url('https://images.unsplash.com/photo-1517817748496-62bc3047b9ff?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat fixed;
    min-height:100vh;
  }
  .overlay{position:relative; z-index:1; background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.35)); min-height:100vh;}
  .wrap{max-width:980px; margin:0 auto; padding:18px 18px 60px;}

  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:8px 0 16px}
  .brand{display:flex; align-items:center; gap:10px}
  .brand-logo{width:28px; height:28px; background:url('/assets/mammon.png') center/contain no-repeat; filter: drop-shadow(0 1px 2px rgba(0,0,0,.5)); cursor:pointer}
  .brand-title{font-weight:900; letter-spacing:.3px}
  .badge{font-size:11px; font-weight:900; padding:4px 8px; border-radius:999px; background:linear-gradient(90deg, var(--accent), var(--accent-2)); color:#111;}
  .header-right{display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end}

  .panel{background:var(--panel); border:1px solid var(--panel-border); border-radius:16px; padding:18px; box-shadow:0 12px 30px var(--shadow); backdrop-filter: blur(6px)}
  h1{margin:6px 0 10px; font-size:30px; font-weight:900}
  .clock{font:42px/1.1 ui-monospace,Menlo,Consolas,monospace; margin:6px 0 10px}
  .status{margin:8px 0 2px; font-weight:900; letter-spacing:.3px}
  .status.open{color:var(--ok)} .status.closed{color:var(--danger)}
  .sub{opacity:.95}
  .row{display:flex; gap:10px; justify-content:center; margin:12px 0 4px}
  .led{width:22px; height:22px; border-radius:7px; border:1px solid rgba(0,0,0,.6); background:#0b1323; box-shadow: inset 0 0 12px rgba(0,0,0,.6), 0 0 12px rgba(0,0,0,.25)}
  .led.g{ background:var(--ok); box-shadow:0 0 10px rgba(34,197,94,.6) }
  .led.r{ background:var(--danger); box-shadow:0 0 10px rgba(239,68,68,.6) }
  .led-info{text-align:center; font-size:12px; opacity:.85; margin-bottom:8px;}
  .meta{margin-top:10px; font-size:12px; opacity:.9}
  .next{margin-top:12px; font-size:13px; opacity:.96}

  /* CTA Privacy */
  .pp-cta-wrap{margin:22px 0 8px; display:flex; justify-content:center}
  .pp-cta{padding:9px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); background:#0f172a; color:#fff; text-decoration:none}
  .pp-cta:hover{border-color:#334155}
  .privacy{display:none; margin-top:16px}
  .privacy .box{background:var(--panel); border:1px solid var(--panel-border); border-radius:16px; padding:16px; box-shadow:0 12px 30px var(--shadow)}
  .privacy h2{margin:0 0 10px; font-size:20px; font-weight:900}
  .privacy h3{margin:16px 0 6px; font-size:16px; font-weight:800}
  .privacy p, .privacy li{color:#dbeafe}

  /* Discord msg */
  .discord-msg{margin-bottom:16px; text-align:center; font-size:14px;}
  .discord-msg a{color:var(--accent); font-weight:bold; text-decoration:none;}
  .discord-msg a:hover{text-decoration:underline;}

  /* Admin (cach√© par d√©faut, accessible via triggers) */
  .admin{display:none; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:16px}
  .admin input[type="time"], .admin input[type="number"]{padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.15); background:#0b0e1a; color:#fff; width:140px}
  .admin .hint{font-size:12px; opacity:.8}
</style>
</head>
<body>
<div class="overlay">
  <div class="wrap">
    <!-- Header -->
    <header>
      <div class="brand">
        <div class="brand-logo" id="secretLogo" aria-hidden="true" title=" "></div>
        <div class="brand-title">MAMMON TIMER</div>
        <span class="badge">LIVE</span>
      </div>
      <div class="header-right">
        <!-- rien de visible (admin cach√©) -->
        <span class="mini-badge" id="patchBadge" title="Star Citizen patch">
          Updated for Star Citizen Patch 4.3.0-LIVE (Hotfix 10188864)
        </span>
      </div>
    </header>

    <!-- Message Discord -->
    <div class="panel discord-msg">
      üöÄ Envie de rejoindre la <strong>MAMMON</strong> ? 
      <a href="https://discord.gg/aUBDScHG" target="_blank" rel="noopener">Rejoins notre Discord ici !</a>
    </div>

    <!-- Timer -->
    <section class="panel">
      <h1>Executive Hangar Timer</h1>
      <div class="clock" id="clock">--:--:--</div>

      <div class="row" id="leds">
        <div class="led r"></div><div class="led r"></div><div class="led r"></div><div class="led r"></div><div class="led r"></div>
      </div>
      <div class="led-info" id="ledInfo">Chaque LED = ‚Äî min</div>

      <div class="status closed" id="status">Hangar Closed</div>
      <div class="sub" id="subtitle">Prochaine transition dans --:--:--</div>

      <div class="next" id="nextTimes">Prochaine fermeture : ‚Äî ‚Ä¢ Prochaine ouverture : ‚Äî</div>
      <div class="meta" id="modeMeta">Aucune ancre d√©finie.</div>

      <!-- Admin cach√© (triggers: dblclick logo / Ctrl+Shift+A / #admin) -->
      <div class="admin" id="adminPanel">
        <label for="openTime"><strong>Derni√®re ouverture (HH:MM)</strong> :</label>
        <input type="time" id="openTime" step="1" />
        <button class="btn" id="applyAnchor">Appliquer</button>

        <span class="hint">ou</span>

        <label for="minsNext"><strong>Min restantes jusqu‚Äôau prochain changement</strong> :</label>
        <input type="number" id="minsNext" step="0.01" min="0" placeholder="ex: 82.17" />
        <button class="btn" id="applyNext">Synchroniser</button>

        <button class="btn" id="pauseResume">Pause</button>
      </div>
    </section>

    <!-- Privacy -->
    <div class="pp-cta-wrap">
      <a href="#privacy" id="ppBtn" class="pp-cta" aria-expanded="false" aria-controls="privacy">Privacy Policy</a>
    </div>
    <section class="privacy" id="privacy" aria-hidden="true">
      <div class="box">
        <h2>Privacy Policy</h2>
        <p><em>Effective Date: September 8, 2025</em></p>

        <p>Welcome! Your privacy matters to us. This Policy explains what we do (and don‚Äôt) collect, how we may use cookies/ads in the future, and your rights.</p>

        <h3>Information We Collect</h3>
        <p>We do <strong>not</strong> collect, sell, or share personal data. Timer preferences are saved in your browser‚Äôs <strong>Local Storage</strong> for convenience. This data stays on your device and is never transmitted to our servers.</p>

        <h3>Cookies &amp; Tracking</h3>
        <p>We currently do not use cookies. In the future, we may enable cookies or similar technologies to show ads (e.g., Google AdSense, Ezoic). These may process non-identifiable data (e.g., page views) to serve relevant ads. You can control or delete cookies in your browser settings at any time.</p>

        <h3>Third-Party Services (Ads)</h3>
        <p>If/when ads are enabled, third-party ad networks (e.g., Google AdSense, Ezoic) may use cookies and similar tech to deliver and measure ads. Please review their respective privacy policies for details on their processing.</p>

        <h3>Your Rights</h3>
        <p>Depending on your location, you may have rights under laws such as <strong>GDPR</strong> (EU/EEA/UK) or <strong>CCPA/CPRA</strong> (California), including access, correction, deletion, objection/restriction, and withdrawing consent (where applicable). Because we do not collect personal data, these rights mainly relate to cookie preferences you control in your browser if/when ads are enabled.</p>

        <h3>Data Retention</h3>
        <p>We do not maintain user profiles or store personal data. Local Storage data remains on your device until you clear it (e.g., ‚ÄúClear Site Data‚Äù in your browser).</p>

        <h3>Children‚Äôs Privacy</h3>
        <p>This site is for a general audience and does not knowingly collect information from children under 13 (or higher local age threshold).</p>

        <h3>Changes to This Policy</h3>
        <p>We may update this Policy from time to time. We will post changes here with a new Effective Date. Please check this page periodically.</p>
      </div>
    </section>

  </div>
</div>

<script>
  /* ===== Param√®tres (d√©riv√©s de tes donn√©es) ===== */
  const OPEN_SEC   = 3901; // ~65:01
  const CLOSED_SEC = 7201; // ~120:01
  const DOTS=5;
  const CYCLE_SEC = OPEN_SEC + CLOSED_SEC;

  /* ===== El√©ments ===== */
  const elClock=document.getElementById('clock');
  const elStatus=document.getElementById('status');
  const elSub=document.getElementById('subtitle');
  const leds=document.getElementById('leds').children;
  const elNext=document.getElementById('nextTimes');
  const elMode=document.getElementById('modeMeta');
  const elLedInfo=document.getElementById('ledInfo');

  const adminPanel=document.getElementById('adminPanel');
  const inputTime=document.getElementById('openTime');
  const applyBtn=document.getElementById('applyAnchor');
  const minsNextInput=document.getElementById('minsNext');
  const applyNextBtn=document.getElementById('applyNext');
  const pauseBtn=document.getElementById('pauseResume');

  const ppBtn=document.getElementById('ppBtn');
  const ppSection=document.getElementById('privacy');

  /* ===== Etat ===== */
  const LS_KEY='mammon_anchor_iso';
  let cfg={anchor_iso:null, paused:false};

  /* ===== Utils ===== */
  const pad=n=>String(n).padStart(2,'0');
  const fmt=s=>{s=Math.max(0,Math.floor(s)); return `${pad(s/3600|0)}:${pad((s%3600)/60|0)}:${pad(s%60)}`;};
  const pretty=ms=>new Date(ms).toLocaleString('fr-FR',{dateStyle:'short', timeStyle:'short'});
  const anchorMs=()=> cfg.anchor_iso ? Date.parse(cfg.anchor_iso) : Date.now();
  const nextAfter=(startMs,stepMs,nowMs)=>(nowMs<startMs)?startMs:startMs+(Math.floor((nowMs-startMs)/stepMs)+1)*stepMs;

  function computeAnchorIsoFromHHMM(hhmm){
    const [hh,mm,ssRaw]=hhmm.split(':');
    const hhN=Number(hh), mmN=Number(mm), ssN=ssRaw?Number(ssRaw):0;
    const now=new Date();
    const d=new Date(now); d.setHours(hhN,mmN,ssN,0);
    if(d.getTime()>now.getTime()) d.setDate(d.getDate()-1); // si futur -> hier
    return new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().replace('.000Z','Z');
  }

  function setAnchorISO(iso){
    cfg.anchor_iso=iso;
    localStorage.setItem(LS_KEY, iso);
    elMode.textContent='Ancre : '+pretty(Date.parse(iso))+' ‚Ä¢ Cycle: ouvert 65:01 / ferm√© 120:01';
    render();
  }

  /* ===== Rendu ===== */
  function render(){
    if(!cfg.anchor_iso){
      elClock.textContent='--:--:--';
      elStatus.className='status closed';
      elStatus.textContent='D√©finis une heure d‚Äôouverture';
      elSub.textContent='Aucune ancre d√©finie';
      elNext.textContent='‚Äî';
      elLedInfo.textContent='Chaque LED = ‚Äî min';
      return;
    }

    const now=Date.now();
    const elapsed=(((now-anchorMs())/1000)%CYCLE_SEC+CYCLE_SEC)%CYCLE_SEC;
    const isOpen=elapsed<OPEN_SEC;
    const remain=isOpen ? OPEN_SEC-elapsed : CYCLE_SEC-elapsed;

    elClock.textContent = fmt(remain);
    elStatus.className='status '+(isOpen?'open':'closed');
    elStatus.textContent = 'Hangar '+(isOpen?'Open':'Closed') + (cfg.paused?' (Paused)':'');
    elSub.textContent = 'Prochaine transition ('+(isOpen?'fermeture':'ouverture')+') dans '+fmt(remain);

    const phaseSec=isOpen?OPEN_SEC:CLOSED_SEC;
    const ledMin = Math.round(phaseSec/60/DOTS);
    elLedInfo.textContent = `Chaque LED = ${ledMin} min (${isOpen?'phase ouverte':'phase ferm√©e'})`;

    const progress=remain/phaseSec;
    let greenCount = isOpen ? Math.ceil(progress*DOTS) : DOTS - Math.ceil(progress*DOTS);
    greenCount=Math.max(0,Math.min(DOTS,greenCount));
    for(let i=0;i<DOTS;i++) leds[i].className='led '+(i<greenCount?'g':'r');

    const nClose=nextAfter(anchorMs()+OPEN_SEC*1000, CYCLE_SEC*1000, now);
    const nOpen =nextAfter(anchorMs(),                CYCLE_SEC*1000, now);
    elNext.textContent = `Prochaine fermeture : ${pretty(nClose)} ‚Ä¢ Prochaine ouverture : ${pretty(nOpen)}`;
  }

  /* ===== Chargement ===== */
  function loadCfg(){
    const ls=localStorage.getItem(LS_KEY);
    if(ls){ cfg.anchor_iso=ls; elMode.textContent='Ancre (local) : '+pretty(Date.parse(ls)); }
    // Pr√©remplir l‚Äôinput
    const d=new Date(); inputTime.value=`${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
    render();
  }

  /* ===== Admin (cach√©) ===== */
  function openAdmin(){ adminPanel.style.display='flex'; }
  function closeAdmin(){ adminPanel.style.display='none'; }

  // Triggers secrets
  const secretLogo = document.getElementById('secretLogo');
  secretLogo.addEventListener('dblclick', openAdmin);
  document.addEventListener('keydown', (e)=>{ if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==='a'){ openAdmin(); }});
  if (location.hash === '#admin'){ setTimeout(openAdmin, 50); }

  // Appliquer √† partir de la derni√®re ouverture (HH:MM[:SS])
  applyBtn.addEventListener('click', ()=>{
    const val=inputTime.value.trim();
    if(!val) return alert('Indique HH:MM ou HH:MM:SS');
    const iso=computeAnchorIsoFromHHMM(val);
    setAnchorISO(iso);
  });

  // Synchroniser via "Time until next change: mm.ss"
  applyNextBtn.addEventListener('click', ()=>{
    const v=Number(minsNextInput.value);
    if(!isFinite(v) || v<0) return alert('Indique les minutes restantes (ex: 82.17)');
    const msToNext = Math.round(v*60*1000);
    // On va estimer la phase actuelle: si on est en phase ferm√©e, le "next change" = ouverture,
    // si phase ouverte, le "next change" = fermeture. Comme on ne sait pas, on pose l'ancre
    // sur "prochaine ouverture" = maintenant + msToNext, puis on recalcule normalement.
    const targetOpen = Date.now() + msToNext;
    const iso = new Date(targetOpen - (new Date().getTimezoneOffset()*60000)).toISOString().replace('.000Z','Z');
    setAnchorISO(iso);
  });

  // Pause/Resume
  pauseBtn.addEventListener('click', ()=>{
    cfg.paused=!cfg.paused;
    pauseBtn.textContent = cfg.paused ? 'Reprendre' : 'Pause';
  });

  /* ===== Privacy: bouton toggle ===== */
  function setPrivacyVisibility(show){
    ppSection.style.display = show ? 'block' : 'none';
    ppSection.setAttribute('aria-hidden', String(!show));
    ppBtn.setAttribute('aria-expanded', String(show));
    if (show) ppSection.scrollIntoView({behavior:'smooth'});
  }
  function togglePrivacy(e){
    e && e.preventDefault();
    const showing = ppSection.style.display === 'block';
    setPrivacyVisibility(!showing);
    if (!showing) { history.replaceState(null, '', '#privacy'); }
    else { history.replaceState(null, '', ' '); }
  }
  ppBtn.addEventListener('click', togglePrivacy);
  if (location.hash === '#privacy') setPrivacyVisibility(true);

  /* ===== Tick ===== */
  setInterval(()=>{ if(!cfg.paused) render(); },1000);

  /* Go */
  loadCfg();
</script>
</body>
</html>
